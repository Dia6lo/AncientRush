(function(){"use strict";Bridge.define("AncientRush.App",{statics:{renderer:null,currentTime:0,Width:800,Height:600,audio:null,config:{properties:{SceneManager:null,Textures:null},init:function(){Bridge.ready(this.main)}},getCurrentScene:function(){return AncientRush.App.getSceneManager().getCurrentScene()},main:function(){AncientRush.App.renderer=PIXI.autoDetectRenderer(AncientRush.App.Width,AncientRush.App.Height,{backgroundColor:1087931});document.body.appendChild(AncientRush.App.renderer.view);AncientRush.App.setTextures(new AncientRush.TexturePool);AncientRush.App.setSceneManager(new AncientRush.SceneManager);AncientRush.App.getSceneManager().open$1(AncientRush.Scenes.MainMenu);window.requestAnimationFrame(AncientRush.App.animate)},animate:function(time){window.requestAnimationFrame(AncientRush.App.animate);AncientRush.App.getCurrentScene().update(time-AncientRush.App.currentTime);AncientRush.App.renderer.render(AncientRush.App.getCurrentScene().getContainer());AncientRush.App.currentTime=time}},$entryPoint:!0});Bridge.define("AncientRush.Extensions",{statics:{set:function(point,value){point.set(value.x,value.y)},subtract:function(point,value){return new PIXI.Point(point.x-value.x,point.y-value.y)},add:function(point,value){return new PIXI.Point(point.x+value.x,point.y+value.y)},multiply:function(point,value){return new PIXI.Point(point.x*value,point.y*value)},normalize:function(point){var val=1/Math.sqrt(point.x*point.x+point.y*point.y);point.x*=val;point.y*=val},$length:function(point){return Math.sqrt(point.x*point.x+point.y*point.y)},getKey:function(e){switch(e.key){case"ArrowUp":return AncientRush.Key.Up;case"ArrowDown":return AncientRush.Key.Down;case"ArrowLeft":return AncientRush.Key.Left;case"ArrowRight":return AncientRush.Key.Right;default:return AncientRush.Key.Unknown}},clamp:function(value,min,max){return value<min?min:value>max?max:value}}});Bridge.define("AncientRush.Scene",{timer:0,fade:null,fadeDuration:0,config:{events:{Closing:null},properties:{Appearing:!1,Container:null}},constructor:function(){this.setContainer(new PIXI.Container)},fadeIn:function(fadeDuration){fadeDuration===void 0&&(fadeDuration=1e3);this.fadeDuration=fadeDuration;this.fade=(new PIXI.Graphics).lineStyle(1).beginFill(0).drawRect(0,0,AncientRush.App.Width,AncientRush.App.Height).endFill();this.getContainer().addChild(this.fade);this.setAppearing(!0);this.timer=0},update:function(delta){this.getAppearing()&&(this.timer+=delta,this.fade.alpha=AncientRush.Utility.lerp(this.timer/this.fadeDuration,1,0),this.fade.alpha<=0&&this.setAppearing(!1))},open:function(scene){Bridge.staticEquals(this.Closing,null)||this.Closing();AncientRush.App.getSceneManager().open(scene)},open$1:function(T){Bridge.staticEquals(this.Closing,null)||this.Closing();AncientRush.App.getSceneManager().open$1(T)}});Bridge.define("AncientRush.Key",{statics:{Unknown:0,Left:1,Right:2,Up:3,Down:4},$enum:!0});Bridge.define("AncientRush.SceneManager",{config:{properties:{CurrentScene:null}},open:function(scene){this.setCurrentScene(scene)},open$1:function(T){this.open(new T)}});Bridge.define("AncientRush.Scenes.Controls.ArrowBoard",{board:null,left:null,right:null,up:null,down:null,constructor:function(){this.board=new PIXI.Sprite(AncientRush.App.getTextures().arrowBoard);this.board.addChild(this.left=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().arrowLeft),{position:new PIXI.Point(4,38)}));this.board.addChild(this.right=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().arrowRight),{position:new PIXI.Point(72,38)}));this.board.addChild(this.up=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().arrowUp),{position:new PIXI.Point(38,4)}));this.board.addChild(this.down=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().arrowDown),{position:new PIXI.Point(38,38)}));this.disable(AncientRush.Scenes.Direction.Up);this.disable(AncientRush.Scenes.Direction.Down);this.disable(AncientRush.Scenes.Direction.Right);this.disable(AncientRush.Scenes.Direction.Left)},getContainer:function(){return this.board},enable:function(direction){this.getSprite(direction).tint=16777215},disable:function(direction){this.getSprite(direction).tint=7829367},getSprite:function(direction){switch(direction){case AncientRush.Scenes.Direction.Left:return this.left;case AncientRush.Scenes.Direction.Right:return this.right;case AncientRush.Scenes.Direction.Up:return this.up;case AncientRush.Scenes.Direction.Down:return this.down;default:throw new System.ArgumentOutOfRangeException("direction",null,null,direction);}}});Bridge.define("AncientRush.Scenes.Controls.Campfire",{idle:null,extinguish:null,config:{properties:{Container:null}},constructor:function(){this.setContainer(new PIXI.Container);this.idle=Bridge.merge(new PIXI.extras.MovieClip([AncientRush.App.getTextures().campfire0,AncientRush.App.getTextures().campfire1]),{loop:!0,animationSpeed:.1});this.getContainer().addChild(this.idle);this.extinguish=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().campfire2),{visible:!1});this.getContainer().addChild(this.extinguish);this.idle.play()},beginExtinguish:function(){this.idle.stop();this.idle.visible=!1;this.extinguish.visible=!0},finishExtinguish:function(){this.extinguish.texture=AncientRush.App.getTextures().campfire3}});Bridge.define("AncientRush.Scenes.Controls.CaveMan",{idle:null,emotions:null,config:{properties:{Container:null}},constructor:function(){this.setContainer(new PIXI.Container);this.idle=Bridge.merge(new PIXI.extras.MovieClip([AncientRush.App.getTextures().caveManMenu0,AncientRush.App.getTextures().caveManMenu1]),{loop:!0,animationSpeed:.05});this.getContainer().addChild(this.idle);this.emotions=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().caveManMenu2),{visible:!1});this.getContainer().addChild(this.emotions);this.idle.play()},noticeChanges:function(){this.idle.stop();this.idle.visible=!1;this.emotions.visible=!0},becomeSad:function(){this.emotions.texture=AncientRush.App.getTextures().caveManMenu3}});Bridge.define("AncientRush.Scenes.Controls.Clouds",{clouds:null,random:null,config:{properties:{Container:null},init:function(){this.clouds=new System.Collections.Generic.Dictionary$2(PIXI.Sprite,System.Single)();this.random=new System.Random("constructor")}},constructor:function(){this.setContainer(new PIXI.Container);this.addCloud(Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().cloud),{position:new PIXI.Point(-AncientRush.App.getTextures().cloud.width,0),scale:new PIXI.Point(1,1)}),2);this.addCloud(Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().cloud),{position:new PIXI.Point(AncientRush.App.Width,100),scale:new PIXI.Point(.75,.75)}),-5)},update:function(){for(var $t1,maxWidth=AncientRush.App.getTextures().cloud.width,cloud,finishedMoving,spawnNewCloud,height,newCloud,$t=Bridge.getEnumerator(System.Linq.Enumerable.from(this.clouds).toList(System.Collections.Generic.KeyValuePair$2(PIXI.Sprite,System.Single)));$t.moveNext();)(cloud=$t.getCurrent(),$t1=cloud.key,$t1.x+=cloud.value,finishedMoving=cloud.value>0&&cloud.key.x>AncientRush.App.Width||cloud.value<0&&cloud.key.x<-maxWidth,finishedMoving)&&(this.getContainer().removeChild(cloud.key),this.clouds.remove(cloud.key));if(spawnNewCloud=this.random.next$1(100)<1,spawnNewCloud){var scale=this.random.next$2(5,10)/10,direction=this.random.next$2(0,2)===0?AncientRush.Scenes.Direction.Left:AncientRush.Scenes.Direction.Right,speed=this.random.nextDouble()*5;direction===AncientRush.Scenes.Direction.Left&&(speed*=-1);height=this.random.next$2(-50,150);newCloud=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().cloud),{scale:new PIXI.Point(scale,scale),position:direction===AncientRush.Scenes.Direction.Right?new PIXI.Point(-maxWidth,height):new PIXI.Point(AncientRush.App.Width,height)});this.addCloud(newCloud,speed)}},addCloud:function(cloud,speed){this.clouds.add(cloud,speed);this.getContainer().addChild(cloud)}});Bridge.define("AncientRush.Scenes.Controls.ProgressBar",{graphics:null,progress:0,config:{events:{MaxReached:null,MinReached:null},properties:{Color:0,DarkColor:0,Height:0,Width:0},init:function(){this.graphics=new PIXI.Graphics}},getSprite:function(){return this.graphics},getProgress:function(){return this.progress},setProgress:function(value){this.progress!==value&&(value<=0?(this.progress=0,Bridge.staticEquals(this.MinReached,null)||this.MinReached()):value>=1?(this.progress=1,Bridge.staticEquals(this.MaxReached,null)||this.MaxReached()):this.progress=value)},update:function(){var radius=10,minWidth=20,progressWidth=this.progress===0?minWidth:minWidth+(this.getWidth()-minWidth)*this.progress;this.graphics.clear().lineStyle(2,this.getDarkColor()).beginFill(this.getColor()).drawRoundedRect(0,0,progressWidth,this.getHeight(),radius).endFill().moveTo(0,0).lineStyle(2).drawRoundedRect(0,0,this.getWidth(),this.getHeight(),radius)}});Bridge.define("AncientRush.Scenes.Controls.SlidingMessage",{timer:0,goalContainer:null,currentState:0,dropInHeight:0,stayHeight:0,dropOutHeight:0,config:{events:{DroppedOut:null}},constructor:function(goalText,tipWidth,tipHeight){this.dropInHeight=-tipHeight;this.stayHeight=300-tipHeight/2;this.dropOutHeight=AncientRush.App.Height;this.goalContainer=Bridge.merge(new PIXI.Graphics,{position:new PIXI.Point(400-tipWidth/2,300-tipHeight/2)});this.goalContainer.lineStyle(2).beginFill(3120687).drawRoundedRect(0,0,tipWidth,tipHeight,10).endFill();var text=Bridge.merge(new PIXI.Text(goalText),{anchor:new PIXI.Point(.5,.5),position:new PIXI.Point(tipWidth/2,tipHeight/2)});this.goalContainer.addChild(text)},getContainer:function(){return this.goalContainer},update:function(delta){if(this.currentState!==AncientRush.Scenes.Controls.SlidingMessage.State.DroppedOut){this.timer+=delta;switch(this.currentState){case AncientRush.Scenes.Controls.SlidingMessage.State.DropIn:this.handleGoalDropIn();break;case AncientRush.Scenes.Controls.SlidingMessage.State.Stay:this.handleGoalStay();break;case AncientRush.Scenes.Controls.SlidingMessage.State.DropOut:this.handleGoalDropOut();break;default:throw new System.ArgumentOutOfRangeException;}}},handleGoalDropIn:function(){this.timer<250?this.goalContainer.position.y=AncientRush.Utility.sinMotion(250,this.timer,this.dropInHeight,this.stayHeight):(this.currentState=AncientRush.Scenes.Controls.SlidingMessage.State.Stay,this.timer=0)},handleGoalStay:function(){this.timer<=1e3||(this.currentState=AncientRush.Scenes.Controls.SlidingMessage.State.DropOut,this.timer=0)},handleGoalDropOut:function(){this.timer<250?this.goalContainer.position.y=AncientRush.Utility.sinMotion(250,this.timer,this.stayHeight,this.dropOutHeight):(this.currentState=AncientRush.Scenes.Controls.SlidingMessage.State.DroppedOut,Bridge.staticEquals(this.DroppedOut,null)||this.DroppedOut())}});Bridge.define("AncientRush.Scenes.Controls.SlidingMessage.State",{statics:{DropIn:0,Stay:1,DropOut:2,DroppedOut:3},$enum:!0});Bridge.define("AncientRush.Scenes.Direction",{statics:{Left:0,Right:1,Up:2,Down:3},$enum:!0});Bridge.define("AncientRush.Scenes.Material",{statics:{Stick:0,Tinder:1},$enum:!0});Bridge.define("AncientRush.Scenes.Timer",{time:0,subscribers:null,nextSubscriber:null,config:{init:function(){this.subscribers=new System.Collections.Generic.List$1(Object)()}},getTime:function(){return this.time},update:function(delta){(this.time+=delta,this.nextSubscriber==null||this.time<this.nextSubscriber.item1)||(this.nextSubscriber.item2(),this.subscribers.remove(this.nextSubscriber),this.nextSubscriber=null,this.findNextSubscriber())},subscribe:function(time,action){if(!(this.time>time)){var newSubscriber={item1:time,item2:action};this.subscribers.add(newSubscriber);(this.nextSubscriber==null||time<this.nextSubscriber.item1)&&(this.nextSubscriber=newSubscriber)}},reset:function(){this.time=0;this.findNextSubscriber()},findNextSubscriber:function(){System.Linq.Enumerable.from(this.subscribers).any()&&(this.nextSubscriber=System.Linq.Enumerable.from(this.subscribers).orderBy($_.AncientRush.Scenes.Timer.f1).first())}});var $_={};Bridge.ns("AncientRush.Scenes.Timer",$_);Bridge.apply($_.AncientRush.Scenes.Timer,{f1:function(s){return s.item1}});Bridge.define("AncientRush.TexturePool",{statics:{Folder:"assets",get:function(name){return PIXI.Texture.fromImage("assets/"+name+".png")}},mainMenuBG:null,caveManMenu0:null,caveManMenu1:null,caveManMenu2:null,caveManMenu3:null,campfire0:null,campfire1:null,campfire2:null,campfire3:null,smoke0:null,smoke1:null,smoke2:null,cloud:null,firestarter1:null,firestarter2:null,arrow:null,map:null,collectibleStick:null,collectibleTinder:null,caveMan0:null,caveMan1:null,caveMan2:null,caveMan3:null,arrowBoard:null,arrowLeft:null,arrowRight:null,arrowUp:null,arrowDown:null,caveClose:null,title:null,pressSpace:null,config:{init:function(){this.mainMenuBG=AncientRush.TexturePool.get("MainMenu");this.caveManMenu0=AncientRush.TexturePool.get("CaveManMenu0");this.caveManMenu1=AncientRush.TexturePool.get("CaveManMenu1");this.caveManMenu2=AncientRush.TexturePool.get("CaveManMenu2");this.caveManMenu3=AncientRush.TexturePool.get("CaveManMenu3");this.campfire0=AncientRush.TexturePool.get("Campfire0");this.campfire1=AncientRush.TexturePool.get("Campfire1");this.campfire2=AncientRush.TexturePool.get("Campfire2");this.campfire3=AncientRush.TexturePool.get("Campfire3");this.smoke0=AncientRush.TexturePool.get("Smoke0");this.smoke1=AncientRush.TexturePool.get("Smoke1");this.smoke2=AncientRush.TexturePool.get("Smoke2");this.cloud=AncientRush.TexturePool.get("Cloud");this.firestarter1=AncientRush.TexturePool.get("Firestarter_1");this.firestarter2=AncientRush.TexturePool.get("Firestarter_2");this.arrow=AncientRush.TexturePool.get("Arrow");this.map=AncientRush.TexturePool.get("Map");this.collectibleStick=AncientRush.TexturePool.get("CollectibleStick");this.collectibleTinder=AncientRush.TexturePool.get("CollectibleTinder");this.caveMan0=AncientRush.TexturePool.get("CaveMan0");this.caveMan1=AncientRush.TexturePool.get("CaveMan1");this.caveMan2=AncientRush.TexturePool.get("CaveMan2");this.caveMan3=AncientRush.TexturePool.get("CaveMan3");this.arrowBoard=AncientRush.TexturePool.get("ArrowBoard");this.arrowLeft=AncientRush.TexturePool.get("ArrowLeft");this.arrowRight=AncientRush.TexturePool.get("ArrowRight");this.arrowUp=AncientRush.TexturePool.get("ArrowUp");this.arrowDown=AncientRush.TexturePool.get("ArrowDown");this.caveClose=AncientRush.TexturePool.get("CaveClose");this.title=AncientRush.TexturePool.get("Title");this.pressSpace=AncientRush.TexturePool.get("PressSpace")}}});Bridge.define("AncientRush.Utility",{statics:{sinMotion:function(time,currentTime,from,to){var v=Math.sin(currentTime/time*(Math.PI/2));return AncientRush.Utility.lerp(v,from,to)},lerp:function(amount,value1,value2){return value1+(value2-value1)*amount}}});Bridge.define("AncientRush.GameScene",{inherits:[AncientRush.Scene],goal:null,config:{properties:{ArrowBoard:null,IsGoalOnScreen:!1}},constructor:function(goalText,tipWidth,tipHeight){AncientRush.Scene.prototype.$constructor.call(this);this.setArrowBoard(new AncientRush.Scenes.Controls.ArrowBoard);this.getArrowBoard().getContainer().position=new PIXI.Point(675,10);this.goal=new AncientRush.Scenes.Controls.SlidingMessage(goalText,tipWidth,tipHeight);this.goal.addDroppedOut(Bridge.fn.bind(this,$_.AncientRush.GameScene.f1));this.setIsGoalOnScreen(!0)},setupControls:function(directions){var $t,direction;for(directions===void 0&&(directions=[]),$t=Bridge.getEnumerator(directions);$t.moveNext();)direction=$t.getCurrent(),this.getArrowBoard().enable(direction)},addOverlay:function(){this.getContainer().addChild(this.getArrowBoard().getContainer());this.getContainer().addChild(this.goal.getContainer())},update:function(delta){AncientRush.Scene.prototype.update.call(this,delta);this.goal.update(delta)}});Bridge.ns("AncientRush.GameScene",$_);Bridge.apply($_.AncientRush.GameScene,{f1:function(){this.setIsGoalOnScreen(!1)}});Bridge.define("AncientRush.Scenes.MainMenu",{inherits:[AncientRush.Scene],statics:{firstTime:!0},caveMan:null,campfire:null,timer$1:null,spacePressed:!1,clouds:null,title:null,subTitle:null,onKeyDown:null,message:null,constructor:function(){AncientRush.Scene.prototype.$constructor.call(this);AncientRush.App.audio!=null&&AncientRush.App.audio.remove();AncientRush.App.audio=new Audio("assets/GF.mp3");document.body.appendChild(AncientRush.App.audio);AncientRush.App.audio.play();this.clouds=new AncientRush.Scenes.Controls.Clouds;this.getContainer().addChild(this.clouds.getContainer());var bg=new PIXI.Sprite(AncientRush.App.getTextures().mainMenuBG);this.getContainer().addChild(bg);this.caveMan=Bridge.merge(new AncientRush.Scenes.Controls.CaveMan,{getContainer:{position:new PIXI.Point(25,250)}});this.getContainer().addChild(this.caveMan.getContainer());this.campfire=Bridge.merge(new AncientRush.Scenes.Controls.Campfire,{getContainer:{position:new PIXI.Point(250,350)}});this.getContainer().addChild(this.campfire.getContainer());this.title=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().title),{position:new PIXI.Point(50,50),visible:AncientRush.Scenes.MainMenu.firstTime});this.getContainer().addChild(this.title);this.subTitle=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().pressSpace),{anchor:new PIXI.Point(.5,.5),position:new PIXI.Point(400,200),visible:AncientRush.Scenes.MainMenu.firstTime});this.getContainer().addChild(this.subTitle);this.onKeyDown=Bridge.fn.bind(this,this.onKeyDown$1);AncientRush.Scenes.MainMenu.firstTime?document.addEventListener("keydown",this.onKeyDown):this.triggerIntro();this.fadeIn(AncientRush.Scenes.MainMenu.firstTime?2500:500)},triggerIntro:function(){this.spacePressed=!0;this.timer$1=new AncientRush.Scenes.Timer;this.timer$1.subscribe(1e3,Bridge.fn.bind(this,$_.AncientRush.Scenes.MainMenu.f1));this.timer$1.subscribe(3e3,Bridge.fn.bind(this,$_.AncientRush.Scenes.MainMenu.f2));this.timer$1.subscribe(4e3,Bridge.fn.bind(this,$_.AncientRush.Scenes.MainMenu.f3));this.timer$1.subscribe(6e3,Bridge.fn.bind(this,$_.AncientRush.Scenes.MainMenu.f4));this.timer$1.subscribe(7e3,Bridge.fn.bind(this,$_.AncientRush.Scenes.MainMenu.f5));this.timer$1.subscribe(9e3,Bridge.fn.bind(this,$_.AncientRush.Scenes.MainMenu.f6))},onKeyDown$1:function(event){this.getAppearing()||System.String.equals(event.key," ")&&(document.removeEventListener("keydown",this.onKeyDown),this.triggerIntro())},update:function(delta){if((AncientRush.Scene.prototype.update.call(this,delta),this.clouds.update(),!this.getAppearing()&&this.spacePressed)&&(this.timer$1.update(delta),this.message!=null&&this.message.update(delta),!(this.timer$1.getTime()>1e3))){var alpha=AncientRush.Utility.lerp(this.timer$1.getTime()/1e3,1,0);this.title.alpha=alpha;this.subTitle.alpha=alpha}}});Bridge.ns("AncientRush.Scenes.MainMenu",$_);Bridge.apply($_.AncientRush.Scenes.MainMenu,{f1:function(){this.message=new AncientRush.Scenes.Controls.SlidingMessage(AncientRush.Scenes.MainMenu.firstTime?"Mine happy!":"Mine happy again!",300,100);this.getContainer().addChild(this.message.getContainer())},f2:function(){this.campfire.beginExtinguish();this.caveMan.noticeChanges()},f3:function(){this.getContainer().removeChild(this.message.getContainer());this.message=new AncientRush.Scenes.Controls.SlidingMessage("Uh-oh",100,100);this.getContainer().addChild(this.message.getContainer())},f4:function(){this.campfire.finishExtinguish();this.caveMan.becomeSad()},f5:function(){this.getContainer().removeChild(this.message.getContainer());this.message=new AncientRush.Scenes.Controls.SlidingMessage("Mine sad",150,100);this.getContainer().addChild(this.message.getContainer())},f6:function(){AncientRush.Scenes.MainMenu.firstTime=!1;this.open$1(AncientRush.Scenes.MaterialCollectionScene)}});Bridge.define("AncientRush.Scenes.TestScene",{inherits:[AncientRush.Scene],statics:{sprite:null,onDown:function(){AncientRush.Scenes.TestScene.sprite.scale.x=.3;AncientRush.Scenes.TestScene.sprite.scale.y=.3}},constructor:function(){AncientRush.Scene.prototype.$constructor.call(this);AncientRush.Scenes.TestScene.sprite=PIXI.Sprite.fromImage("assets/Shia.png");AncientRush.Scenes.TestScene.sprite.position.set(200,200);AncientRush.Scenes.TestScene.sprite.anchor.set(.5,.5);AncientRush.Scenes.TestScene.sprite.interactive=!0;AncientRush.Scenes.TestScene.sprite.on("mousedown",AncientRush.Scenes.TestScene.onDown);AncientRush.Scenes.TestScene.sprite.on("touchstart",AncientRush.Scenes.TestScene.onDown);this.getContainer().addChild(AncientRush.Scenes.TestScene.sprite)},update:function(){var $t;$t=AncientRush.Scenes.TestScene.sprite;$t.rotation+=.2}});Bridge.define("AncientRush.Scenes.FirestarterScene",{inherits:[AncientRush.GameScene],statics:{ProgressBarReductionSpeed:-1e4},leftTexture:null,rightTexture:null,hand:null,currentDirection:0,timer$1:0,smoke:null,progress:0,keyPressed:null,config:{init:function(){this.leftTexture=AncientRush.App.getTextures().firestarter1;this.rightTexture=AncientRush.App.getTextures().firestarter2}},constructor:function(){AncientRush.GameScene.prototype.$constructor.call(this,"Mine rubs sticks!",300,100);var bg=new PIXI.Sprite(AncientRush.App.getTextures().caveClose);this.getContainer().addChild(bg);this.smoke=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().smoke0),{alpha:.75,anchor:new PIXI.Point(.5,.5),position:new PIXI.Point(400,475),visible:!1});this.keyPressed=Bridge.fn.bind(this,this.keyPressed$1);this.hand=Bridge.merge(new PIXI.Sprite(this.rightTexture),{anchor:new PIXI.Point(.5,.5),position:new PIXI.Point(500,360)});this.setCurrentDirection(AncientRush.Scenes.Direction.Right);this.getContainer().addChild(this.hand);this.getContainer().addChild(this.smoke);document.addEventListener("keydown",this.keyPressed);this.addOverlay()},setCurrentDirection:function(value){if(this.currentDirection!==value){this.currentDirection=value;switch(value){case AncientRush.Scenes.Direction.Left:this.hand.texture=this.leftTexture;this.getArrowBoard().disable(AncientRush.Scenes.Direction.Left);this.getArrowBoard().enable(AncientRush.Scenes.Direction.Right);break;case AncientRush.Scenes.Direction.Right:this.hand.texture=this.rightTexture;this.getArrowBoard().disable(AncientRush.Scenes.Direction.Right);this.getArrowBoard().enable(AncientRush.Scenes.Direction.Left)}this.setProgress(this.progress+.025)}},keyPressed$1:function(e){if(!this.getIsGoalOnScreen()){var key=AncientRush.Extensions.getKey(e);switch(key){case AncientRush.Key.Left:this.setCurrentDirection(AncientRush.Scenes.Direction.Left);break;case AncientRush.Key.Right:this.setCurrentDirection(AncientRush.Scenes.Direction.Right);break;default:return}}},update:function(delta){AncientRush.GameScene.prototype.update.call(this,delta);this.setProgress(this.progress+delta/AncientRush.Scenes.FirestarterScene.ProgressBarReductionSpeed)},setProgress:function(value){if(this.progress!==value){if(value<=0){this.progress=0;this.smoke.visible=!1;return}if(value>.1&&(this.smoke.visible=!0),value>=1){this.smoke.texture=AncientRush.App.getTextures().smoke2;this.progress=1;document.removeEventListener("keydown",this.keyPressed);this.open$1(AncientRush.Scenes.MainMenu);return}this.progress=value;this.smoke.texture=value<=.33?AncientRush.App.getTextures().smoke0:value<=.66?AncientRush.App.getTextures().smoke1:AncientRush.App.getTextures().smoke2}}});Bridge.define("AncientRush.Scenes.MaterialCollectionScene",{inherits:[AncientRush.GameScene],statics:{Speed:5,StickCount:2,TinderCount:3},headingAngle:0,isMoving:!1,isRotating:!1,rotation:0,isHoldingMaterial:!1,currentMaterial:0,sticks:null,tinders:null,random:null,caveMan:null,tipArrow:null,tipArrowDirection:1,collectedSticks:0,collectedTinders:0,config:{init:function(){this.sticks=new System.Collections.Generic.List$1(PIXI.Sprite)();this.tinders=new System.Collections.Generic.List$1(PIXI.Sprite)();this.random=new System.Random("constructor")}},constructor:function(){var map,caveManTextures,onKeyDown,onKeyUp;AncientRush.GameScene.prototype.$constructor.call(this,"Mine collects tinder and sticks!",450,100);map=new PIXI.Sprite(AncientRush.App.getTextures().map);this.getContainer().addChild(map);this.generateMaterials(this.sticks,AncientRush.App.getTextures().collectibleStick,AncientRush.Scenes.MaterialCollectionScene.StickCount);this.generateMaterials(this.tinders,AncientRush.App.getTextures().collectibleTinder,AncientRush.Scenes.MaterialCollectionScene.TinderCount);caveManTextures=[AncientRush.App.getTextures().caveMan0,AncientRush.App.getTextures().caveMan1,AncientRush.App.getTextures().caveMan2,AncientRush.App.getTextures().caveMan3];this.tipArrow=Bridge.merge(new PIXI.Sprite(AncientRush.App.getTextures().arrow),{position:new PIXI.Point(100,100),visible:!1});this.getContainer().addChild(this.tipArrow);this.caveMan=Bridge.merge(new PIXI.extras.MovieClip(caveManTextures),{anchor:new PIXI.Point(.5,.5),position:new PIXI.Point(100,100),loop:!0,animationSpeed:.1});this.getContainer().addChild(this.caveMan);onKeyDown=Bridge.fn.bind(this,this.onKeyDown);onKeyUp=Bridge.fn.bind(this,this.onKeyUp);document.addEventListener("keydown",onKeyDown);document.addEventListener("keyup",onKeyUp);this.addClosing(function(){document.removeEventListener("keydown",onKeyDown);document.removeEventListener("keyup",onKeyUp)});this.setupControls([AncientRush.Scenes.Direction.Up,AncientRush.Scenes.Direction.Left,AncientRush.Scenes.Direction.Right]);this.addOverlay()},getHeadingRadians:function(){return this.headingAngle*PIXI.DEG_TO_RAD},getHeadingVector:function(){return new PIXI.Point(Math.cos(this.getHeadingRadians()),Math.sin(this.getHeadingRadians()))},generateMaterials:function(sprites,texture,count){for(var sprite,i=0;i<count;i=i+1|0)sprite=Bridge.merge(new PIXI.Sprite(texture),{position:this.generateMaterialPosition(),anchor:new PIXI.Point(.5,.5)}),this.getContainer().addChild(sprite),sprites.add(sprite)},generateMaterialPosition:function(){for(var x=0,y=0;x<200&&y<200;)x=this.getRandomFloat(100,600),y=this.getRandomFloat(100,400);return new PIXI.Point(x,y)},getRandomFloat:function(min,max){var range=max-min,offset=range*this.random.nextDouble();return min+offset},onKeyDown:function(e){if(!this.getIsGoalOnScreen()){var key=AncientRush.Extensions.getKey(e);switch(key){case AncientRush.Key.Up:this.isMoving=!0;this.caveMan.gotoAndPlay(1);break;case AncientRush.Key.Left:this.isRotating||(this.isRotating=!0,this.rotation=AncientRush.Scenes.Direction.Left);break;case AncientRush.Key.Right:this.isRotating||(this.isRotating=!0,this.rotation=AncientRush.Scenes.Direction.Right);break;default:return}}},onKeyUp:function(e){if(!this.getIsGoalOnScreen()){var key=AncientRush.Extensions.getKey(e);switch(key){case AncientRush.Key.Up:this.isMoving=!1;this.caveMan.gotoAndStop(0);break;case AncientRush.Key.Left:this.isRotating&&this.rotation===AncientRush.Scenes.Direction.Left&&(this.isRotating=!1);break;case AncientRush.Key.Right:this.isRotating&&this.rotation===AncientRush.Scenes.Direction.Right&&(this.isRotating=!1);break;default:return}}},update:function(delta){if(AncientRush.GameScene.prototype.update.call(this,delta),!this.getIsGoalOnScreen()){if(this.isRotating){var angleOffset=5*(this.rotation===AncientRush.Scenes.Direction.Right?1:-1)|0;this.headingAngle+=angleOffset}this.caveMan.rotation=this.getHeadingRadians();this.isMoving&&(this.caveMan.position=AncientRush.Extensions.add(this.caveMan.position,AncientRush.Extensions.multiply(this.getHeadingVector(),AncientRush.Scenes.MaterialCollectionScene.Speed)),this.caveMan.position.x=AncientRush.Extensions.clamp(this.caveMan.position.x,100,700),this.caveMan.position.y=AncientRush.Extensions.clamp(this.caveMan.position.y,100,500));this.checkCaveCollision();this.checkGoals();this.checkCollisions(this.sticks,AncientRush.Scenes.Material.Stick);this.checkCollisions(this.tinders,AncientRush.Scenes.Material.Tinder);this.updateTipArrow()}},checkGoals:function(){this.collectedTinders===AncientRush.Scenes.MaterialCollectionScene.TinderCount&&this.collectedSticks===AncientRush.Scenes.MaterialCollectionScene.StickCount&&this.open$1(AncientRush.Scenes.FirestarterScene)},updateTipArrow:function(){var $t;$t=this.tipArrow.position;$t.y+=this.tipArrowDirection;(this.tipArrow.position.y>=110||this.tipArrow.position.y<=100)&&(this.tipArrowDirection*=-1)},checkCaveCollision:function(){if(this.isHoldingMaterial){var cavePosition=new PIXI.Point(125,110),range=AncientRush.Extensions.$length(AncientRush.Extensions.subtract(this.caveMan.position,cavePosition));if(!(range>20)){switch(this.currentMaterial){case AncientRush.Scenes.Material.Stick:this.collectedSticks=this.collectedSticks+1|0;break;case AncientRush.Scenes.Material.Tinder:this.collectedTinders=this.collectedTinders+1|0}this.isHoldingMaterial=!1;this.tipArrow.visible=!1}}},checkCollisions:function(sprites,material){var $t,sprite,range;if(!this.isHoldingMaterial)for($t=Bridge.getEnumerator(sprites);$t.moveNext();)(sprite=$t.getCurrent(),sprite.visible)&&((range=AncientRush.Extensions.$length(AncientRush.Extensions.subtract(this.caveMan.position,sprite.position)),range>20)||(sprite.visible=!1,this.isHoldingMaterial=!0,this.tipArrow.visible=!0,this.currentMaterial=material))}});Bridge.init()})(this);